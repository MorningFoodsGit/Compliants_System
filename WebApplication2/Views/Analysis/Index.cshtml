@model WebApplication2.Models.cmplnt_base
@{
    ViewData["Title"] = "Index";
}

<div class="row">
    <div class="col-xs-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Retailers Chart</h4>
                <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                <div class="heading-elements">
                    <ul class="list-inline mb-0">
                        <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                        <li><a data-action="reload"><i class="icon-reload"></i></a></li>
                        <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                        <li><a data-action="close"><i class="icon-cross2"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body collapse in">
                <div class="card-block">
                    <p class="card-text">A bar chart is a horizontal bar chart rendered in the browser using SVG or VML, whichever is appropriate for the user's browser. Like all google charts, bar charts display tooltips when the user hovers over the data.</p>
                    <div class="chart-container">
                        
                        <div id="bar-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Product Category</h4>
                <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                <div class="heading-elements">
                    <ul class="list-inline mb-0">
                        <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                        <li><a data-action="reload"><i class="icon-reload"></i></a></li>
                        <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                        <li><a data-action="close"><i class="icon-cross2"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body collapse in">
                <div class="card-block">
                    <p class="card-text">A bar chart is a horizontal bar chart rendered in the browser using SVG or VML, whichever is appropriate for the user's browser. Like all google charts, bar charts display tooltips when the user hovers over the data.</p>
                    <div class="chart-container">
                        <canvas id="productCategoryChart" width="1000" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Bar Chart</h4>
                <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                <div class="heading-elements">
                    <ul class="list-inline mb-0">
                        <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                        <li><a data-action="reload"><i class="icon-reload"></i></a></li>
                        <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                        <li><a data-action="close"><i class="icon-cross2"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body collapse in">
                <div class="card-block">
                    <p class="card-text">A bar chart is a horizontal bar chart rendered in the browser using SVG or VML, whichever is appropriate for the user's browser. Like all google charts, bar charts display tooltips when the user hovers over the data.</p>
                    <div class="chart-container" style="width: 80%; margin: auto; height: 80%;" Height="400px" width="200px">
                        <div id="chart_div" style="width: 100%; height: 400px;"></div>
                        <div id="bar-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
    <script>
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            // Fetch data from the server
            fetch('/Analysis/GetChartData')
                .then(response => response.json())
                .then(data => {
                    const dataTable = new google.visualization.DataTable();
                    dataTable.addColumn('string', 'Retailer');
                    dataTable.addColumn('string', 'Product Code');
                    dataTable.addColumn('string', 'Product Description');

                    data.forEach(item => {
                        dataTable.addRow([item.rtlr, item.prdct_cde_mf, item.prdct_desc]);
                    });

                    const options = {
                        title: 'Retailers and Products',
                        width: '100%',
                        height: 500,
                        allowHtml: true
                    };

                    const chart = new google.visualization.Table(document.getElementById('chart_div'));

                    google.visualization.events.addListener(chart, 'select', function () {
                        const selection = chart.getSelection();
                        if (selection.length > 0) {
                            const selectedItem = dataTable.getValue(selection[0].row, 1); // Get selected product code
                            console.log(`Selected Product Code: ${selectedItem}`);
                            // Add your logic to handle the click event
                        }
                    });

                    chart.draw(dataTable, options);
                })
                .catch(error => console.error('Error fetching chart data:', error));
        }
    </script>
}


